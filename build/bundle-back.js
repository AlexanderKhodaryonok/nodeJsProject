!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=require("express")},function(e,t,n){const{Schema:r,model:o}=n(3),i=new r({title:{type:String,required:!0},price:{type:Number,required:!0},img:String});e.exports=o("SortOfVino",i)},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("mongoose")},function(e,t,n){e.exports=n(5)},function(e,t,n){(function(e){const t=n(0),r=n(2),o=n(6),i=n(7),s=n(8),a=n(11),c=n(12),d=n(3),u=t(),l=process.env.PORT||8081,f=o.create({defaultLayout:"main",extname:"hbs"});u.engine("hbs",f.engine),u.set("view engine","hbs"),u.set("views","views"),u.use(t.static(r.join(e,"public"))),u.use(t.urlencoded({extended:!0})),async function(){try{const e="mongodb+srv://Alexander:zQC2Ik77F5Lgpe8Q@cluster0-s4qji.mongodb.net/shop";await d.connect(e,{useNewUrlParser:!0,useFindAndModify:!1,useUnifiedTopology:!0}),u.use("/",i),u.use("/add",a),u.use("/catalog",c),u.use("/card",s),u.listen(l,()=>{console.log(`server is running on PORT ${l}...`)})}catch(e){u.get("/",(e,t)=>{t.set("Content-Type","text/html, charset=utf-8"),t.send("<h1>Technical problems with this server</h1>")}),u.listen(l,()=>{console.log(`server is not running on PORT ${l}...`)})}}()}).call(this,"/")},function(e,t){e.exports=require("express-handlebars")},function(e,t,n){const{Router:r}=n(0),o=r();o.get("/",(e,t)=>{t.render("index",{title:"Main Page",isMain:!0})}),e.exports=o},function(e,t,n){const{Router:r}=n(0),o=r(),i=n(9),s=n(1);o.post("/add",async(e,t)=>{const n=await s.getById(e.body.id);await i.add(n),t.redirect("/card")}),o.delete("/remove/:id",async(e,t)=>{const n=await i.remove(e.params.id);t.json(n)}),o.get("/",async(e,t)=>{const n=await i.fetch();t.render("card",{title:"Basket",isCard:!0,sorts:n.sorts,price:n.price})}),e.exports=o},function(e,t,n){const r=n(2),o=n(10),i=r.join(r.dirname(process.mainModule.filename),"data","card.json");class s{static async add(e){const t=await s.fetch(),n=t.sorts.findIndex(t=>t.id===e.id),r=t.sorts[n];return r?(r.count++,t.sorts[n]=r):(e.count=1,t.sorts.push(e)),t.price+=+e.price,new Promise((e,n)=>{o.writeFile(i,JSON.stringify(t),t=>{t?n(t):e()})})}static async fetch(){return new Promise((e,t)=>{o.readFile(i,"utf-8",(n,r)=>{n?t(n):e(JSON.parse(r))})})}static async remove(e){const t=await s.fetch(),n=t.sorts.findIndex(t=>t.id===e),r=t.sorts[n];return 1===r.count?t.sorts=t.sorts.filter(t=>t.id!==e):t.sorts[n].count--,t.price-=r.price,new Promise((e,n)=>{o.writeFile(i,JSON.stringify(t),r=>{r?n(r):e(t)})})}}e.exports=s},function(e,t){e.exports=require("fs")},function(e,t,n){const{Router:r}=n(0),o=n(1),i=r();i.get("/",(e,t)=>{t.render("add",{title:"Add vino",isAdd:!0})}),i.post("/",async(e,t)=>{const n=new o({title:e.body.title,price:e.body.price,img:e.body.img});try{await n.save(),t.redirect("/catalog")}catch(e){console.log(e)}}),e.exports=i},function(e,t,n){const{Router:r}=n(0),o=n(1),i=r();i.get("/",async(e,t)=>{const n=await o.find();t.render("catalog",{title:"Catalog",isCatalog:!0,sorts:n})}),i.get("/:id/edit",async(e,t)=>{if(!e.query.allow)return t.redirect("/");{const n=await o.findById(e.params.id);t.render("catalogEdit",{title:"Edit",sort:n})}}),i.post("/edit",async(e,t)=>{const{id:n}=e.body;delete e.body.id,await o.findByIdAndUpdate(n,e.body),t.redirect("/catalog")}),i.post("/remove",async(e,t)=>{try{await o.deleteOne({_id:e.body.id}),t.redirect("/catalog")}catch(e){console.log(e)}}),i.get("/:id",async(e,t)=>{const n=await o.findById(e.params.id);t.render("catalogInnerPage",{layout:"empty",title:"Sort",sort:n})}),e.exports=i}]);